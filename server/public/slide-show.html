<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>ğŸŒ¸æ¨±ä¹‹é—´ğŸŒ¸</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script type="text/javascript" src="./js/jquery.min.js"></script>
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
        <script src="/js/vue.min.js"></script>
        <script src="/js/axios.min.js"></script>
        <!-- è®©IE8/9æ”¯æŒåª’ä½“æŸ¥è¯¢ï¼Œä»è€Œå…¼å®¹æ …æ ¼ -->
        <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="layui-fluid" id="app">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                          <button type="button" class="layui-btn" id="upload">
                            <i class="layui-icon">&#xe67c;</i>ä¸Šä¼ å›¾ç‰‡
                          </button>
                          <button class="layui-btn"  @click="addSlide"><i class="layui-icon">î˜ˆ</i>æ·»åŠ è½®æ’­å›¾</button>
                            
                            <hr>
                            
                        </div>
                        
                        <div class="layui-card-body ">
                            <table class="layui-table layui-form">
                              <thead>
                                <tr>
                                  
                                  <th >ç¼©ç•¥å›¾</th>
                                  <th>url</th>
                                  <th >æ“ä½œ</th>
                              </thead>
                              <tbody class="x-cate">
                                <tr v-for="(slide,index) in slides" :key="slide.id">
                                  
                                  <td>
                                    <img style="max-width: 150px;height: 100px;" :src="slide.url" alt="">
                                  </td>
                                  <td>
                                    {{slide.url}}
                                  </td>
                                  <td class="td-manage">
                                    <button class="layui-btn-danger layui-btn layui-btn-xs"  @click="deleteSlide(slide.id,index)" ><i class="layui-icon">&#xe640;</i>åˆ é™¤</button>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                        </div>
                       
                    </div>
                </div>
            </div>
        </div>
        <script src="/js/config.js"></script>
        <script>
          const app = new Vue({
              el:'#app',
              data:{
                slides:[],
                uploadSlideUrl:''//è¦æ·»åŠ è½®æ’­å›¾çš„url
              },
              beforeCreate(){
                Http.get('/slide/').then((res)=>{
                  const data = res.data
                  this.slides = data.data
                })
              },
              methods:{
                //æ·»åŠ è½®æ’­å›¾
                addSlide(){
                  if(this.uploadSlideUrl){
                    Http.post('/slide/add',{
                      url:this.uploadSlideUrl
                    }).then(res=>{
                      const data = res.data
                      this.slides.push(data.data)
                      this.uploadSlideUrl = ''
                    })
                  }else{
                    layer.msg('è¯·å…ˆä¸Šä¼ å›¾ç‰‡', {icon: 2})
                  }
                },
                //åˆ é™¤è½®æ’­å›¾
                deleteSlide(id,index){
                  //åˆ é™¤æ•°æ®åº“æ•°æ®
                  Http.post('/slide/delete',{
                      id
                  }).then(res=>{
                    const deleteSlide = this.slides.splice(index,1)[0]
                    
                    layer.msg('åˆ é™¤æˆåŠŸ', {icon: 1})
                    //åˆ é™¤ä¸Šä¼ çš„æ–‡ä»¶
                    Http.post('/file/delete',{
                        url:deleteSlide.url
                      }).then(res=>{
                        console.log(res.data)
                    })
                  })
                },
                
              }
          })
        </script>
        <script>
          //å›¾ç‰‡ä¸Šä¼ 
          layui.use(['form','upload'], function(){
              var upload = layui.upload
          
              //æ‰§è¡Œå®ä¾‹
              var uploadInst = upload.render({
                  elem: '#upload', //ç»‘å®šå…ƒç´ 
                  url: '/api/v1/file/upload', //ä¸Šä¼ æ¥å£
                  done: function(res){
                      //ä¸Šä¼ å®Œæ¯•å›è°ƒ
                      console.log(res.data.url)
                      app.uploadSlideUrl = res.data.url
                  },
                  error: function(){
                      //è¯·æ±‚å¼‚å¸¸å›è°ƒ
                  }
              })
          })
      </script>
    </body>
</html>
