<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>üå∏Ê®±‰πãÈó¥üå∏</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
        <script src="./js/vue.min.js"></script>
        <script src="./js/axios.min.js"></script>
    </head>
    
    <body>
        <div class="layui-fluid" id="app">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <form class="layui-form layui-col-space5">
                                <div class="layui-input-inline layui-show-xs-block">
                                    <input class="layui-input" placeholder="ÂºÄÂßãÊó•" name="start" id="start">
                                </div>
                                <div class="layui-input-inline layui-show-xs-block">
                                    <input class="layui-input" placeholder="Êà™Ê≠¢Êó•" name="end" id="end">
                                </div>
                                
                                <div class="layui-input-inline layui-show-xs-block">
                                    <select lay-filter="select" :value="currentOrderStatus">
                                        <option value="-1">ÂÖ®ÈÉ®</option>
                                        <option value="0">ÂæÖ‰ªòÊ¨æ</option>
                                        <option value="1">ÂæÖÂèëË¥ß</option>
                                        <option value="2">ÂæÖÊî∂Ë¥ß</option>
                                        <option value="3">ÂæÖËØÑ‰ª∑</option>
                                        <option value="4">Â∑≤ÁªìÊùü</option>
                                    </select>
                                </div>
                                <div class="layui-input-inline layui-show-xs-block">
                                    <input type="text" name="username" placeholder="ËØ∑ËæìÂÖ•ËÆ¢ÂçïÂè∑" autocomplete="off" class="layui-input"></div>
                                <div class="layui-input-inline layui-show-xs-block">
                                    <button class="layui-btn" lay-submit="" lay-filter="sreach">
                                        <i class="layui-icon">&#xe615;</i></button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="layui-card-body ">
                            <table class="layui-table layui-form">
                                <thead>
                                    <tr>
                                        <th>ËÆ¢ÂçïÁºñÂè∑</th>
                                        <th>ËÆ¢ÂçïÁä∂ÊÄÅ</th>
                                        <th>Êî∂Ë¥ß‰∫∫</th>
                                        <th>Êî∂Ë¥ß‰∫∫ÁîµËØùÂè∑Á†Å</th>
                                        <th>Êî∂Ë¥ßÂú∞ÂùÄ</th>
                                        <th>Â∫î‰ªòÈáëÈ¢ù</th>
                                        <th>‰∏ãÂçïÊó∂Èó¥</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="order in orders" :key="order.id">
                                        <td>{{order.serialNumber}}</td>
                                        <td v-if="order.status === 0" style="color: #FFB800;">{{order.statusText}}</td>
                                        <td v-if="order.status === 1" style="color: #FF5722;">{{order.statusText}}</td>
                                        <td v-if="order.status === 2" style="color: #009688;">{{order.statusText}}</td>
                                        <td v-if="order.status == 3" style="color: #1e9fff;">{{order.statusText}}</td>
                                        <td v-if="order.status === 4" style="color: #393D49;">{{order.statusText}}</td>
                                        <td>{{order.address.name}}</td>
                                        <td>{{order.address.phoneNumber}}</td>
                                        <td>{{order.address.detail}}</td>
                                        <td>Ôø•{{order.price}}</td>
                                        <td>{{order.createdAt}}</td>
                                        <td class="td-manage">
                                            <a v-if="order.status === 1" title="ÂèëË¥ß" @click="sendGoods(order.id)">
                                                <i style="cursor: pointer;" class="layui-icon layui-icon-release"></i>
                                            </a>
                                            <a title="Êü•ÁúãËØ¶ÊÉÖ" @click="xadmin.open('Êü•ÁúãËÆ¢ÂçïËØ¶ÊÉÖ','order-view.html?id='+order.id)">
                                                <i style="cursor: pointer;" class="layui-icon">&#xe63c;</i></a>

                                            <a title="Âà†Èô§" onclick="" href="javascript:;">
                                                <i style="cursor: pointer;" class="layui-icon">&#xe640;</i></a>
                                        </td>
                                    </tr>
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script src="./js/config.js"></script>
    <script>
        layui.use(['laydate', 'form'],function() {
            var laydate = layui.laydate;
            var form = layui.form;

            form.on('select(select)', function(data){
                console.log(data.value); //ÂæóÂà∞Ë¢´ÈÄâ‰∏≠ÁöÑÂÄº
                app.currentOrderStatus = parseInt(data.value)
            })

            //ÊâßË°å‰∏Ä‰∏™laydateÂÆû‰æã
            laydate.render({
                elem: '#start' //ÊåáÂÆöÂÖÉÁ¥†
            });

            //ÊâßË°å‰∏Ä‰∏™laydateÂÆû‰æã
            laydate.render({
                elem: '#end' //ÊåáÂÆöÂÖÉÁ¥†
            });
        })

        const app = new Vue({
            el:'#app',
            data:{
                allOrders:[],
                currentOrderStatus:-1// Ê†πÊçÆËÆ¢ÂçïÁä∂ÊÄÅÁ≠õÈÄâËÆ¢ÂçïÂàóË°® -1ÂÖ®ÈÉ®
            },
            computed:{
                orders(){
                    if(this.currentOrderStatus == -1){
                        return this.allOrders
                    }else{
                        return this.allOrders.filter(ele=>{
                            return ele.status == this.currentOrderStatus
                        })
                    }
                }
            },
            beforeCreate(){
                //Ëé∑ÂèñËÆ¢ÂçïÂàóË°®
                Http.get('/order/all').then((res)=>{
                    const data = res.data
                    this.allOrders = data.data.map(ele=>{
                        ele.createdAt = formatTime(ele.createdAt)
                        const statusTexts = ['ÂæÖ‰ªòÊ¨æ','ÂæÖÂèëË¥ß','ÂæÖÊî∂Ë¥ß','ÂæÖËØÑ‰ª∑','Â∑≤ÁªìÊùü']
                        ele.statusText = statusTexts[ele.status]
                        return ele
                    })
                })
            },
            methods:{
                //ÂèëÈÄÅË¥ßÁâ©
                sendGoods(orderId){
                    console.log(orderId)
                    layer.confirm('Á°ÆÂÆöÂèëÈÄÅË¥ßÁâ©ÂêóÔºü', {icon: 3, title:'ÊèêÁ§∫'}, function(index){
                        //do something
                        Http.post('/order/status',{
                            id:orderId,
                            status:2
                        }).then(res=>{
                            const data = res.data
                            if(data.status){
                                window.location.reload()
                            }
                        })

                        layer.close(index)
                    })
                }
            }
        })

    </script>

</html>